---

title: Match resimulation


keywords: fastai
sidebar: home_sidebar

summary: "Simulating match outcomes based on the xG of individual shots"
description: "Simulating match outcomes based on the xG of individual shots"
nb_path: "nbs/resimulation.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/resimulation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Use Poisson-Binomial distribution calculation from <a href="https://github.com/tsakim/poibin">https://github.com/tsakim/poibin</a></p>
<p>It looks like <a href="https://github.com/tsakim/poibin/pull/8">there are plans to package the code</a>, but for now, just copy+paste the requisite class in here (original code is provided with MIT License).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="PoiBin" class="doc_header"><code>class</code> <code>PoiBin</code><a href="https://github.com/torvaney/wingback/tree/master/wingback/resimulation.py#L14" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>PoiBin</code>(<strong><code>probabilities</code></strong>)</p>
</blockquote>
<p>Poisson Binomial distribution for random variables.
This class implements the Poisson Binomial distribution for Bernoulli
trials with different success probabilities. The distribution describes
thus a random variable that is the sum of independent and not identically
distributed single Bernoulli random variables.
The class offers methods for calculating the probability mass function, the
cumulative distribution function, and p-values for right-sided testing.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="poisson_binomial_pmf" class="doc_header"><code>poisson_binomial_pmf</code><a href="https://github.com/torvaney/wingback/tree/master/wingback/resimulation.py#L210" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>poisson_binomial_pmf</code>(<strong><code>probs</code></strong>, <strong><code>xs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="resimulate_match" class="doc_header"><code>resimulate_match</code><a href="https://github.com/torvaney/wingback/tree/master/wingback/resimulation.py#L214" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>resimulate_match</code>(<strong><code>shots</code></strong>, <strong><code>up_to</code></strong>=<em><code>26</code></em>, <strong><code>min_xg</code></strong>=<em><code>0.0001</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>'Resimulate' a match based on xG. Takes a list of maps, where each map
represents a shot has and has 'is_home' (bool) and 'xg' (float) keys.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">extract_prob</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">home_goals</span><span class="p">,</span> <span class="n">away_goals</span><span class="p">):</span>
    <span class="n">filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">probs</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;home_goals&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">home_goals</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;away_goals&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">away_goals</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">filtered</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;probability&#39;</span><span class="p">]</span>


<span class="n">probs</span> <span class="o">=</span> <span class="n">resimulate_match</span><span class="p">([</span>
    <span class="p">{</span><span class="s1">&#39;is_home&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;xg&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">}</span>
<span class="p">])</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">extract_prob</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shots</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;is_home&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;xg&quot;</span><span class="p">:</span> <span class="mf">0.030929630622267723</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;is_home&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;xg&quot;</span><span class="p">:</span> <span class="mf">0.021505167707800865</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;is_home&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;xg&quot;</span><span class="p">:</span> <span class="mf">0.013733051717281342</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;is_home&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;xg&quot;</span><span class="p">:</span> <span class="mf">0.06314441561698914</span><span class="p">},</span>
<span class="p">]</span>
<span class="n">probs</span> <span class="o">=</span> <span class="n">resimulate_match</span><span class="p">(</span><span class="n">shots</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
    <span class="n">extract_prob</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;xg&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">shots</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

